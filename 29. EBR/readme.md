# EBR


### Описание 
Edition-based redefinition.
Это технология баз данных Oracle, позволяющая использовать несколько версий объектов PL/SQL.
Что позволяет выполнять обновления приложений базы данных без простоя.

### Решаемая проблема.
Релиз PL/SQL программы требует остановки БД. Посколько процесс компиляции этого кода должен был получить эксклюзивную блокировку.
Приходится выделять технические окна для релиза PL/SQL программ.
EBR не полностью решает эту проблему, но существенно облегчает релиз программ PL/SQL.

### Какие объекты могут версионироваться.
  - Все объекты PL/SQL. FUNCTION, PROCEDURE, PACKAGE, TRIGGER, TYPE, LIBRARY
  - VIEW
  - SYNONYM
  - Таблицы


### Как работает. Пример с установкой патча.
  0. Сейчас в БД редакция по умолчанию № 1. В ней находятся пакеты CONTACT_PKG, PERSON_PKG, CLIENT_PKG.
  1. Пользователи 1, 2, 3 работают с БД редакции № 1.
  2. Пользоветели 4, 5 на обеде и не подключены к БД.  
  3. Начинаем установку патча. Создается новая редакция № 2. В ней меняется только пакет PERSON_PKG. 
  5. PERSON_PKG полностью копируется из старой редакции и в него вносятся изменения.
  6. По пакетам, которые не изменились, делаем ссылку на редакцию № 1. Тем самым используем оттуда.
  7. После установки патча редакция № 2 устанавливается редакцией по умолчанию. alter database default edition = ED_1180_23185307 
  8. Пользователи 4, 5 подключаются к БД и они уже подключаются к редакции № 2. alter session set edition = ED_1180_23185307 
  9. Как только у пользователей 1, 2, 3 будет новая сессия, то они так же подключатся уже к редакции № 2. 


### Получить текущую редакцию 
````
select property_value  
  from database_properties 			 
 where property_name = 'DEFAULT_EDITION';
````
Приложение хранит это значение и регулярно опрашивает базу, не изменилось ли оно.


### Ограничения
  - Ограничение на число редакций, равное 2000
  - Не-версионируемые (non-editioned) объекты не могут ссылаться на версионируемые
  -
  -
  


### Ссылки
  - https://vc.ru/s/1168538-dexsys/550585-blesk-i-nishcheta-tehnologii-edition-based-redefinition-v-oracle-database-chast-1-blesk
  - https://habr.com/ru/companies/qiwi/articles/343782/