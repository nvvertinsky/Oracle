# STATSPACK


### Описание
  - Предшественник AWR, создает "снимки" с данными из системных представлений
  - Снимки создаются автоматическим заданием 1 раз в час, данные хранятся 7 дней
  - Есть 2 джоба
    - Один вызывает STATSPACK.SNAP и собирает статистику.
	- Второй STATSPACK.PURGE(sysdate - 7, true). Удаляет старую статистику, которой более 7 дней


### Джобы: 
````
select job, 
       what, 
       interval, 
       failures, 
       broken
  from dba_jobs
 where what like '%statspack%' 
    or what like '%statspack.snap%';
````

### Представления 
````
select * from perfstat.stats$snapshot;  # Выбрать необходимые снимки для построения отчета за период между ними

````

### Генерация отчета
````
@?/rdbms/admin/spreport.sql   # Общий основной отчет
@?/rdbms/admin/sprepsql.sql   # Отчет по конкретному запросу
````

### Инструкция: 
  1. Заходим в папку где находится файл spreport.sql
  2. Вызываем из папки cmd 
  3. Подключаемся к sqlplus system/password@TST
  4. Пишем: @spreport.sql
  5. Скрипт попросит указать 2 снимка
  6. В представлении perfstat.stats$snapshot находим 2 нужным нам снимка
  7. Файл в отчетом будет сохранен в эту же папку



### Самое интересное 
  - В основном отчете есть SQL ordered by CPU. Это SQL которые заняли больше всего времени.
  - Время (в секундах) за выполнение одно SQL указано в CPU per Exec (s)

